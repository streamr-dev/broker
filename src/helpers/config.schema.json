{
  "$id": "config.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "description": "Broker configuration format",
  "type": "object",
  "required": [
    "adapters",
    "cassandra",
    "ethereumPrivateKey",
    "network",
    "reporting",
    "streamrUrl"
  ],
  "additionalProperties": false,
  "properties": {
    "adapters": {
      "type": "array",
      "description": "Foreign protocol adapters to use",
      "items": {
        "$ref": "#/definitions/adapter"
      }
    },
    "cassandra": {
      "type": "object",
      "description": "Apache Cassandra configuration",
      "required": [
        "hosts",
        "username",
        "password",
        "keyspace",
        "datacenter"
      ],
      "additionalProperties": false,
      "properties": {
        "hosts": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "hostname"
          },
          "minItems": 1,
          "uniqueItems": true
        },
        "username": {
          "type": "string"
        },
        "password": {
          "type": "string"
        },
        "keyspace": {
          "type": "string"
        },
        "datacenter": {
          "type": "string"
        }
      }
    },
    "ethereumPrivateKey": {
      "type": "string",
      "description": "Ethereum private key to establish broker identity",
      "pattern": "^[a-f0-9]{64}$"
    },
    "network": {
      "type": "object",
      "description": "Network node settings",
      "required": [
        "name",
        "hostname",
        "port",
        "advertisedWsUrl",
        "isStorageNode",
        "location"
      ],
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string",
          "description": "Human-readable name for network node"
        },
        "hostname": {
          "type": "string",
          "format": "hostname",
          "description": "Hostname to start network node on"
        },
        "port": {
          "type": "integer",
          "minimum": 0,
          "maximum": 65353,
          "description": "Port to start network node on"
        },
        "advertisedWsUrl": {
          "type": [
            "string",
            "null"
          ],
          "description": "Override WS URL to advertise to tracker and other nodes (useful when behind NAT)"
        },
        "isStorageNode": {
          "type": "boolean",
          "description": "Whether to identify as storage node or not"
        },
        "location": {
          "description": "Location of node",
          "oneOf": [
            {
              "type": "null",
              "description": "Location undefined"
            },
            {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "latitude",
                "longitude",
                "country",
                "city"
              ],
              "properties": {
                "latitude": {
                  "type": [
                    "number",
                    "null"
                  ]
                },
                "longitude": {
                  "type": [
                    "number",
                    "null"
                  ]
                },
                "country": {
                  "type": [
                    "string",
                    "null"
                  ]
                },
                "city": {
                  "type": [
                    "string",
                    "null"
                  ]
                }
              }
            }
          ]
        }
      }
    },
    "reporting": {
      "type": "object",
      "description": "Configuration for reporting, metrics gathering, error gathering etc.",
      "required": [
        "intervalInSeconds",
        "streamr",
        "sentry"
      ]
    },
    "streamrUrl": {
      "type": "string",
      "description": "Base URL of Core (E&E) API to use",
      "format": "uri"
    }
  },
  "definitions": {
    "adapter": {
      "type": "object",
      "description": "Configuration of a single foreign protocol adapter",
      "required": [
        "name"
      ],
      "additionalProperties": true,
      "properties": {
        "name": {
          "type": "string",
          "description": "Identifier of adapter",
          "enum": [
            "ws",
            "http",
            "mqtt"
          ]
        }
      }
    }
  }
}